<!doctype html>
<html lang="th" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>‡∏£‡πâ‡∏≤‡∏ô‡∏û‡∏≠‡πÉ‡∏à‡∏™‡∏£‡∏∞‡∏î‡πà‡∏ß‡∏ô - ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; font-family: 'Prompt', sans-serif; -webkit-tap-highlight-color: transparent; }
    .gradient-bg { background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 50%, #e0f7fa 100%); }
    .card-shadow { box-shadow: 0 10px 40px rgba(0, 150, 200, 0.1), 0 4px 12px rgba(0, 0, 0, 0.05); }
    .btn-press { transition: all 0.15s ease; }
    .btn-press:active { transform: scale(0.96); }
    .toast { animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards; }
    @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
    .photo-preview { animation: scaleIn 0.3s ease; }
    @keyframes scaleIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .pulse-ring { animation: pulse 2s infinite; }
    @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); } 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } }
  </style>
 </head>
 <body class="h-full">
  <div id="app" class="h-full gradient-bg overflow-auto relative">
   
   <div class="absolute top-4 right-4 z-20">
     <button id="lang-btn" onclick="toggleLanguage()" class="bg-white/90 backdrop-blur px-3 py-1.5 rounded-full shadow-md text-sm font-semibold text-sky-600 border border-sky-100 flex items-center gap-2 btn-press">
       <span id="lang-icon">üá∫üá∏</span> <span id="lang-text">EN</span>
     </button>
   </div>

   <div class="min-h-full p-4 pb-8">
    <div class="text-center mb-6 pt-4">
     <div class="inline-flex items-center justify-center w-16 h-16 rounded-full mb-3" style="background: linear-gradient(135deg, #0ea5e9, #06b6d4);">
      <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
     </div>
     <h1 class="text-2xl font-bold text-gray-800" data-i18n="appTitle">‡∏£‡πâ‡∏≤‡∏ô‡∏û‡∏≠‡πÉ‡∏à‡∏™‡∏£‡∏∞‡∏î‡πà‡∏ß‡∏ô</h1>
     <p class="text-gray-500 text-sm mt-1" data-i18n="appSubtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</p>
    </div>
    
    <div class="bg-white rounded-2xl p-4 mb-4 card-shadow mx-auto max-w-md">
     <div class="text-center">
       <p id="current-date" class="text-lg font-semibold text-gray-700"></p>
       <p id="current-time" class="text-3xl font-bold text-sky-600"></p>
     </div>
    </div>

    <div class="bg-white rounded-3xl p-6 card-shadow mx-auto max-w-md">
     
     <div class="mb-5">
       <label class="block text-gray-600 text-sm font-medium mb-2"> 
         <span class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg> 
            <span data-i18n="labelName">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</span>
         </span> 
       </label> 
       <input type="text" id="employee-name" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-sky-400 focus:outline-none transition-colors text-lg" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô...">
     </div>

     <div class="mb-5">
       <label class="block text-gray-600 text-sm font-medium mb-2"> 
         <span class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg> 
            <span data-i18n="labelShift">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</span> <span class="text-red-500">*</span>
         </span> 
       </label> 
       <div class="grid grid-cols-2 gap-3">
         <button type="button" onclick="selectShift('09:00')" id="btn-shift-morning" class="shift-btn py-3 px-2 rounded-xl border-2 border-gray-200 text-gray-500 font-medium transition-all hover:border-sky-300 flex flex-col items-center justify-center gap-1 bg-white">
           <svg class="w-6 h-6 mb-1 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
           <span data-i18n="shiftMorning">‡∏Å‡∏∞‡πÄ‡∏ä‡πâ‡∏≤ (09:00)</span>
         </button>
         <button type="button" onclick="selectShift('15:00')" id="btn-shift-afternoon" class="shift-btn py-3 px-2 rounded-xl border-2 border-gray-200 text-gray-500 font-medium transition-all hover:border-sky-300 flex flex-col items-center justify-center gap-1 bg-white">
           <svg class="w-6 h-6 mb-1 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
           <span data-i18n="shiftAfternoon">‡∏Å‡∏∞‡∏ö‡πà‡∏≤‡∏¢ (15:00)</span>
         </button>
       </div>
     </div>

     <div class="mb-5">
       <label class="block text-gray-600 text-sm font-medium mb-2"> 
         <span class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg> 
            <span data-i18n="labelPhoto">‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô</span> <span class="text-red-500">*</span> 
         </span> 
       </label>
       <div id="photo-container" class="relative">
         <div id="photo-preview-wrapper" class="hidden">
           <img id="photo-preview" class="w-full h-48 object-cover rounded-xl photo-preview"> 
           <button id="retake-btn" class="absolute top-2 right-2 bg-white/90 text-gray-700 p-2 rounded-full shadow-lg btn-press">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
           </button>
         </div>
         <button id="camera-btn" class="w-full h-48 border-3 border-dashed border-sky-300 rounded-xl flex flex-col items-center justify-center gap-3 bg-sky-50/50 hover:bg-sky-100/50 transition-colors btn-press pulse-ring">
          <div class="w-16 h-16 rounded-full bg-sky-500 flex items-center justify-center">
           <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
          </div>
          <span class="text-sky-600 font-medium" data-i18n="tapToPhoto">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</span>
         </button>
       </div>
       <input type="file" id="camera-input" accept="image/*" capture="user" class="hidden">
     </div>

     <div class="grid grid-cols-2 gap-4">
       <button id="checkin-btn" class="py-4 px-4 rounded-2xl font-semibold text-white text-lg flex flex-col items-center gap-2 btn-press" style="background: linear-gradient(135deg, #22c55e, #16a34a);">
         <svg class="w-8 h-8" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" /></svg>
         <span data-i18n="btnCheckIn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</span> 
       </button> 
       <button id="checkout-btn" class="py-4 px-4 rounded-2xl font-semibold text-white text-lg flex flex-col items-center gap-2 btn-press" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
         <svg class="w-8 h-8" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
         <span data-i18n="btnCheckOut">‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô</span> 
       </button>
     </div>
     
     <p id="warning-msg" class="text-center text-amber-600 text-sm mt-4 flex items-center justify-center gap-1">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg> 
      <span data-i18n="warningPhoto">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤</span>
     </p>
    </div>

    <div id="records-section" class="mt-6 mx-auto max-w-md hidden">
     <h3 class="text-gray-600 font-medium mb-3 flex items-center gap-2">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" /></svg> 
      <span data-i18n="recentRecords">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
     </h3>
     <div id="records-list" class="space-y-2"></div>
    </div>
   </div>

   <div id="toast-container" class="fixed top-4 left-4 right-4 z-50 flex flex-col items-center gap-2"></div>
   <div id="loading-overlay" class="fixed inset-0 bg-black/30 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl p-6 flex flex-col items-center gap-3">
     <div class="w-10 h-10 border-4 border-sky-200 border-t-sky-500 rounded-full animate-spin"></div>
     <p class="text-gray-600 font-medium" data-i18n="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>
   </div>
  </div>
  
  <script>
    // ============================================
    // ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
    // ============================================
    
    // URL ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx8fkqrbN4N8i1yFlMNB5SUkMHZyOttIX4YLgv9IkPaqBHdpsd3CWPMpoIqUxEbefQ1Tw/exec'; 
    
    // ============================================
    // ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏≤
    // ============================================
    
    let currentLang = 'th'; 

    const dictionary = {
      th: {
        appTitle: "‡∏£‡πâ‡∏≤‡∏ô‡∏û‡∏≠‡πÉ‡∏à‡∏™‡∏£‡∏∞‡∏î‡πà‡∏ß‡∏ô",
        appSubtitle: "‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô",
        labelName: "‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô",
        placeholderName: "‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô...",
        labelShift: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô",
        shiftMorning: "‡∏Å‡∏∞‡πÄ‡∏ä‡πâ‡∏≤ (09:00)",
        shiftAfternoon: "‡∏Å‡∏∞‡∏ö‡πà‡∏≤‡∏¢ (15:00)",
        labelPhoto: "‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô",
        tapToPhoto: "‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ",
        btnCheckIn: "‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô",
        btnCheckOut: "‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô",
        warningPhoto: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤",
        recentRecords: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î",
        loading: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...",
        toastEmptyName: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô",
        toastEmptyShift: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏∞‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô",
        toastEmptyPhoto: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤",
        toastProcessing: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ...",
        toastSuccess: "‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
        toastError: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà",
        viewPhoto: "‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢",
        recordSaved: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢",
        langBtnText: "EN",
        langBtnIcon: "üá∫üá∏"
      },
      en: {
        appTitle: "Porjai Salon",
        appSubtitle: "Attendance System",
        labelName: "Nickname",
        placeholderName: "Enter nickname...",
        labelShift: "Select Shift",
        shiftMorning: "Morning (09:00)",
        shiftAfternoon: "Afternoon (15:00)",
        labelPhoto: "Take Photo",
        tapToPhoto: "Tap to take photo",
        btnCheckIn: "Check In",
        btnCheckOut: "Check Out",
        warningPhoto: "Please take a photo first",
        recentRecords: "Recent Records",
        loading: "Saving data...",
        toastEmptyName: "Please enter nickname",
        toastEmptyShift: "Please select a shift",
        toastEmptyPhoto: "Please take a photo first",
        toastProcessing: "Saving data and uploading...",
        toastSuccess: "Success",
        toastError: "Error! Please try again",
        viewPhoto: "View Photo",
        recordSaved: "Saved",
        langBtnText: "TH",
        langBtnIcon: "üáπüá≠"
      }
    };

    function toggleLanguage() {
      currentLang = currentLang === 'th' ? 'en' : 'th';
      updateInterfaceLanguage();
    }

    function updateInterfaceLanguage() {
      const texts = dictionary[currentLang];
      
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (texts[key]) el.textContent = texts[key];
      });

      document.getElementById('employee-name').placeholder = texts.placeholderName;
      document.getElementById('lang-text').textContent = texts.langBtnText;
      document.getElementById('lang-icon').textContent = texts.langBtnIcon;

      renderRecords();
      updateDateTime();
    }

    // ============================================

    let currentPhotoData = null;
    let records = [];
    let isProcessing = false;
    let currentShift = null; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏Å‡∏∞‡∏á‡∏≤‡∏ô

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏∞
    function selectShift(time) {
      currentShift = time;
      
      // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      document.querySelectorAll('.shift-btn').forEach(btn => {
        btn.classList.remove('border-sky-500', 'bg-sky-50', 'text-sky-700', 'ring-2', 'ring-sky-200');
        btn.classList.add('border-gray-200', 'text-gray-500');
      });

      // ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      const activeId = time === '09:00' ? 'btn-shift-morning' : 'btn-shift-afternoon';
      const activeBtn = document.getElementById(activeId);
      if(activeBtn) {
        activeBtn.classList.remove('border-gray-200', 'text-gray-500');
        activeBtn.classList.add('border-sky-500', 'bg-sky-50', 'text-sky-700', 'ring-2', 'ring-sky-200');
      }
    }

    // ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
    function updateDateTime() {
      const now = new Date();
      const locale = currentLang === 'th' ? 'th-TH' : 'en-GB'; 
      
      document.getElementById('current-date').textContent = now.toLocaleDateString(locale, { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      document.getElementById('current-time').textContent = now.toLocaleTimeString(locale, { 
        hour: '2-digit', 
        minute: '2-digit', 
        second: '2-digit', 
        hour12: false 
      });
    }

    // ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (Toast)
    function showToast(messageKey, type = 'success', dynamicText = '') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      
      let message = dictionary[currentLang][messageKey] || messageKey;
      if (dynamicText) message += ` - ${dynamicText}`;

      const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-amber-500';
      toast.className = `toast ${bgColor} text-white px-4 py-3 rounded-xl shadow-lg flex items-center gap-2 max-w-sm`;
      toast.innerHTML = `<span class="font-medium">${message}</span>`;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function setLoading(show) {
      document.getElementById('loading-overlay').classList.toggle('hidden', !show);
      isProcessing = show;
    }

    function setupCamera() {
      const cameraBtn = document.getElementById('camera-btn');
      const cameraInput = document.getElementById('camera-input');
      const retakeBtn = document.getElementById('retake-btn');
      const photoPreview = document.getElementById('photo-preview');
      const photoPreviewWrapper = document.getElementById('photo-preview-wrapper');
      const warningMsg = document.getElementById('warning-msg');

      cameraBtn.addEventListener('click', () => cameraInput.click());
      retakeBtn.addEventListener('click', () => cameraInput.click());

      cameraInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            currentPhotoData = event.target.result;
            photoPreview.src = currentPhotoData;
            photoPreviewWrapper.classList.remove('hidden');
            cameraBtn.classList.add('hidden');
            warningMsg.classList.add('hidden');
          };
          reader.readAsDataURL(file);
        }
      });
    }

    function resetPhoto() {
      currentPhotoData = null;
      document.getElementById('photo-preview-wrapper').classList.add('hidden');
      document.getElementById('camera-btn').classList.remove('hidden');
      document.getElementById('warning-msg').classList.remove('hidden');
      document.getElementById('camera-input').value = '';
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏´‡∏°‡πà ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ Shift)
    async function recordTime(actionTypeKey) {
      if (isProcessing) return;
      
      const employeeName = document.getElementById('employee-name').value.trim();
      
      // Validation
      if (!employeeName) { showToast('toastEmptyName', 'warning'); return; }
      if (!currentShift) { showToast('toastEmptyShift', 'warning'); return; } // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏∞
      if (!currentPhotoData) { showToast('toastEmptyPhoto', 'warning'); return; }

      if (APPS_SCRIPT_URL.includes('xxxx') || APPS_SCRIPT_URL === '') {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Apps Script URL ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡πà‡∏≠‡∏ô', 'error');
        return;
      }

      setLoading(true);

      const actionType = actionTypeKey === 'btnCheckIn' ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô' : '‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô';
      const actionDisplay = dictionary[currentLang][actionTypeKey];

      try {
        const now = new Date();
        const dateDisplay = now.toLocaleDateString('th-TH', { day: '2-digit', month: '2-digit', year: 'numeric' });
        const timeDisplay = now.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit', hour12: false });
        
        const payload = {
          employee_name: employeeName,
          shift: currentShift, // ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏∞‡πÑ‡∏õ‡∏ó‡∏µ‡πà Sheet
          action_type: actionType,
          photo_base64: currentPhotoData,
          date_display: dateDisplay,
          time_display: timeDisplay
        };

        showToast('toastProcessing', 'warning');
        
        await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors', 
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        showToast('toastSuccess', 'success', `${actionDisplay} - ${employeeName}`);
        resetPhoto();

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å LocalStorage (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)
        const recordForDisplay = { ...payload, photo_data: '' }; 
        records.push(recordForDisplay);
        localStorage.setItem('attendance_records', JSON.stringify(records));
        renderRecords();

      } catch (error) {
        console.error(error);
        showToast('toastError', 'error');
      } finally {
        setLoading(false);
      }
    }

    function renderRecords() {
      const recordsSection = document.getElementById('records-section');
      const recordsList = document.getElementById('records-list');
      const texts = dictionary[currentLang];
      
      if (records.length === 0) {
        recordsSection.classList.add('hidden');
        return;
      }

      recordsSection.classList.remove('hidden');
      const recentRecords = records.slice().reverse().slice(0, 5); 
      
      recordsList.innerHTML = recentRecords.map(record => {
        const isCheckin = record.action_type === '‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô';
        const displayAction = isCheckin ? texts.btnCheckIn : texts.btnCheckOut;
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏∞‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏î‡πâ‡∏ß‡∏¢ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        const shiftInfo = record.shift ? ` (${record.shift})` : '';

        const bgColor = isCheckin ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';
        const icon = isCheckin 
          ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14"/>'
          : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7"/>';
        
        const photoHtml = record.photo_data && record.photo_data.startsWith('http')
          ? `<a href="${record.photo_data}" target="_blank" class="text-xs text-sky-500 hover:underline block mt-1">${texts.viewPhoto}</a>` 
          : `<span class="text-xs text-gray-400 block mt-1">${texts.recordSaved}</span>`;

        return `
          <div class="flex items-center gap-3 p-3 ${bgColor} border rounded-xl">
            <div class="w-10 h-10 rounded-full ${isCheckin ? 'bg-green-500' : 'bg-red-500'} flex items-center justify-center">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">${icon}</svg>
            </div>
            <div class="flex-1">
              <p class="font-medium text-gray-800">${record.employee_name} <span class="text-xs text-gray-400 font-normal">${shiftInfo}</span></p>
              <p class="text-sm text-gray-500">${record.date_display} - ${record.time_display}</p>
              ${photoHtml}
            </div>
            <span class="px-3 py-1 rounded-full text-sm font-medium ${isCheckin ? 'text-green-600 bg-green-100' : 'text-red-600 bg-red-100'}">
              ${displayAction}
            </span>
          </div>
        `;
      }).join('');
    }

    function init() {
      updateDateTime();
      setInterval(updateDateTime, 1000);
      setupCamera();
      
      const saved = localStorage.getItem('attendance_records');
      if (saved) {
        records = JSON.parse(saved);
        renderRecords();
      }

      document.getElementById('checkin-btn').addEventListener('click', () => recordTime('btnCheckIn'));
      document.getElementById('checkout-btn').addEventListener('click', () => recordTime('btnCheckOut'));
      
      updateInterfaceLanguage();
    }

    init();
  </script>
 </body>
</html>